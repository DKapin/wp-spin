#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Check if lint-staged is installed, if not, use regular checks
if [ -x "$(command -v npx)" ] && [ -x "$(command -v lint-staged)" ]; then
  echo "âœ“ Running lint-staged for efficient checks on staged files"
  npx lint-staged
else
  # Type check
  echo "ğŸ” Checking TypeScript types..."
  npm run build --if-present -- --noEmit
  if [ $? -ne 0 ]; then
    echo "âŒ TypeScript check failed. Please fix type errors before committing."
    exit 1
  fi
  
  # Run quick tests
  echo "ğŸ§ª Running tests..."
  npm run test:quick
  if [ $? -ne 0 ]; then
    echo "âŒ Tests failed. Please fix test failures before committing."
    exit 1
  fi
  
  # Run linting
  echo "ğŸ§¹ Linting code..."
  npm run lint
  if [ $? -ne 0 ]; then
    echo "âŒ Linting failed. Please fix linting issues before committing."
    exit 1
  fi
fi

echo "âœ… All checks passed! Proceeding with commit..."
